<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Set New Password | Good Hands</title>
  <link rel="stylesheet" href="css/register.css">
</head>
<body>
  <div class="form-page">
    <div class="form-container">
      <div class="form-header">
        <div class="login-icon">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 17a2 2 0 100-4 2 2 0 000 4zm6-7h-1V7a5 5 0 00-10 0v3H6a2 2 0 00-2 2v9a2 2 0 002 2h12a2 2 0 002-2v-9a2 2 0 00-2-2zm-8-3a3 3 0 016 0v3h-6V7zm8 14H6v-9h12v9z"/>
          </svg>
        </div>
        <h1>New Password</h1>
        <p>Please enter your new secure password</p>
      </div>

      <form id="resetForm">
        <div class="input-group">
          <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path fill="#4FD1B5" d="M12 17a2 2 0 100-4 2 2 0 000 4zm6-7h-1V7a5 5 0 00-10 0v3H6a2 2 0 00-2 2v9a2 2 0 002 2h12a2 2 0 002-2v-9a2 2 0 00-2-2zm-8-3a3 3 0 016 0v3h-6V7zm8 14H6v-9h12v9z"/>
          </svg>
          <input type="password" id="newPassword" placeholder="New Password" required>
        </div>

        <button type="submit" class="submit-btn">Update Password</button>
      </form>
      <div id="res" style="text-align:center; margin-top:10px; font-size:13px;"></div>
    </div>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');

    document.getElementById('resetForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const password = document.getElementById('newPassword').value;

      const response = await fetch('../php/execute-reset.php', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ token, password })
      });
      const data = await response.json();
      
      if(data.success) {
          alert("Success! Redirecting to login...");
          window.location.href = "login.html";
      } else {
          document.getElementById('res').innerHTML = data.message;
          document.getElementById('res').style.color = "red";
      }
    });
  </script>
</body>
</html>